<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Media</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root{
    --bg: #f8fafc;          /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© */
    --card: #ffffff;        /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    --accent: #ec4899;      /* ÙˆØ±Ø¯ÙŠ */
    --accent-2: #f472b6;    /* ÙˆØ±Ø¯ÙŠ ÙØ§ØªØ­ */
    --muted: #64748b;
    --glass: rgba(0,0,0,0.05);
    --success: #10b981;
    --text: #1e293b;
    --border: #e2e8f0;
    --shadow: 0 10px 25px rgba(0,0,0,0.05);
  }
  
  *{box-sizing:border-box}
  html,body{
    height:100%;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; 
    background:var(--bg); 
    color:var(--text); 
    margin:0; 
    direction:rtl;
    transition: all 0.3s ease;
  }
  
  .wrap{
    max-width: 100%;
    margin: 0 auto;
    padding: 16px;
    background:var(--card); 
    border-radius:24px; 
    box-shadow: var(--shadow); 
    border:1px solid var(--border); 
    position:relative; 
    overflow:hidden;
    min-height: 100vh;
  }
  
  @media (min-width: 768px) {
    .wrap {
      max-width: 95%;
      margin: 20px auto;
      padding: 24px;
      min-height: auto;
    }
  }
  
  @media (min-width: 1200px) {
    .wrap {
      max-width: 1200px;
      padding: 32px;
    }
  }
  
  .wrap::before{
    content:'';
    position:absolute;
    top:0;
    right:0;
    width:100%;
    height:4px;
    background:linear-gradient(90deg, var(--accent), var(--accent-2));
    border-radius: 24px 24px 0 0;
  }
  
  header{
    display:flex;
    flex-direction: column;
    gap: 16px;
    align-items: center;
    margin-bottom: 24px;
    text-align: center;
  }
  
  @media (min-width: 768px) {
    header {
      flex-direction: row;
      text-align: right;
    }
  }
  
  .logo{
    width: 70px;
    height: 70px;
    border-radius:20px;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    display:grid;
    place-items:center;
    font-weight:700;
    color:#fff;
    font-size:24px;
    box-shadow: 0 8px 20px rgba(236, 72, 153, 0.3);
  }
  
  @media (min-width: 768px) {
    .logo {
      width: 80px;
      height: 80px;
      font-size: 28px;
    }
  }
  
  h1{
    font-size: 24px;
    margin: 0;
    background:linear-gradient(90deg, var(--accent), var(--accent-2));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    font-weight: 700;
  }
  
  @media (min-width: 768px) {
    h1 {
      font-size: 28px;
    }
  }
  
  p.lead{
    color:var(--muted);
    margin:8px 0 0;
    font-size: 14px;
    line-height:1.6;
  }
  
  @media (min-width: 768px) {
    p.lead {
      font-size: 16px;
    }
  }
  
  .tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 24px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 8px;
  }
  
  .tab {
    padding: 10px 20px;
    border-radius: 12px;
    background: transparent;
    border: none;
    color: var(--muted);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .tab.active {
    background: var(--accent);
    color: white;
    box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
  }
  
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
  
  form.grid{
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  
  @media (min-width: 992px) {
    form.grid {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 24px;
    }
  }
  
  .card{
    background:var(--card);
    padding: 20px;
    border-radius:20px;
    border:1px solid var(--border); 
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
  }
  
  .card:hover {
    box-shadow: 0 15px 35px rgba(0,0,0,0.08);
  }
  
  @media (min-width: 768px) {
    .card {
      padding: 24px;
    }
  }
  
  label{
    display:block;
    font-size:14px;
    color:var(--muted);
    margin-bottom:8px;
    font-weight:600;
  }
  
  .uploader{
    border:2px dashed var(--border);
    padding: 30px 20px;
    border-radius:20px;
    min-height:180px;
    display:flex;
    flex-direction:column;
    gap:16px;
    justify-content:center;
    align-items:center;
    text-align:center;
    transition:all 0.3s ease; 
    background:rgba(236, 72, 153, 0.02);
  }
  
  @media (min-width: 768px) {
    .uploader {
      padding: 40px 24px;
      min-height: 200px;
    }
  }
  
  .uploader:hover, .uploader.dragover{
    border-color:var(--accent);
    background:rgba(236, 72, 153, 0.05);
    transform: translateY(-2px);
  }
  
  .uploader small{
    color:var(--muted);
    font-size:14px;
  }
  
  input[type=file]{
    display:none;
  }
  
  .btn{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    border:none;
    padding: 12px 20px;
    border-radius:12px;
    color:#fff;
    font-weight:600;
    cursor:pointer;
    box-shadow: 0 8px 20px rgba(236, 72, 153, 0.3); 
    transition:all 0.3s ease; 
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-size: 14px;
  }
  
  @media (min-width: 768px) {
    .btn {
      padding: 12px 24px;
      font-size: 15px;
    }
  }
  
  .btn:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 25px rgba(236, 72, 153, 0.4);
  }
  
  .btn:active{
    transform:translateY(0);
  }
  
  .controls{
    display:flex;
    flex-direction: column;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
    margin-top:16px;
    width: 100%;
  }
  
  @media (min-width: 576px) {
    .controls {
      flex-direction: row;
      justify-content: center;
    }
  }
  
  .caption{
    width:100%;
    padding:16px;
    border-radius:12px;
    border:1px solid var(--border);
    background:var(--card);
    color:inherit;
    min-height:100px;
    resize:vertical;
    font-family:inherit;
    font-size:14px;
    transition: all 0.3s ease;
  }
  
  .caption:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 3px rgba(236, 72, 153, 0.1);
  }
  
  .meta{
    font-size:14px;
    color:var(--muted);
    display:flex;
    flex-direction: column;
    gap:8px;
    flex-wrap:wrap;
    justify-content:center;
    align-items: center;
  }
  
  @media (min-width: 576px) {
    .meta {
      flex-direction: row;
      gap: 12px;
    }
  }
  
  .file-list{
    display:flex;
    flex-direction:column;
    gap:12px;
    max-height:300px;
    overflow:auto;
    padding:4px;
    margin-top:16px;
  }
  
  .file-list::-webkit-scrollbar{
    width:6px;
  }
  
  .file-list::-webkit-scrollbar-track{
    background:var(--border);
    border-radius:10px;
  }
  
  .file-list::-webkit-scrollbar-thumb{
    background:var(--accent);
    border-radius:10px;
  }
  
  .file-item{
    display:flex;
    align-items:center;
    gap:16px;
    padding:16px;
    border-radius:16px;
    background:var(--bg);
    border:1px solid var(--border);
    transition:all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .file-item::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom, var(--accent), var(--accent-2));
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .file-item:hover{
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
  }
  
  .file-item:hover::before {
    opacity: 1;
  }
  
  .thumb{
    width: 50px;
    height: 50px;
    border-radius:12px;
    background:var(--bg);
    display:grid;
    place-items:center;
    font-size:14px;
    color:var(--muted);
    overflow:hidden;
    flex-shrink:0;
    border: 1px solid var(--border);
  }
  
  @media (min-width: 576px) {
    .thumb {
      width: 64px;
      height: 64px;
    }
  }
  
  .fi-name{
    font-size:14px; 
    color:var(--text);
    white-space:nowrap; 
    text-overflow:ellipsis; 
    overflow:hidden; 
    max-width: 150px;
    font-weight:600;
  }
  
  @media (min-width: 576px) {
    .fi-name {
      max-width: 280px;
    }
  }
  
  .fi-size{
    font-size:13px;
    color:var(--muted);
    margin-top:4px;
  }
  
  .send-btn{
    width:100%;
    margin-top:16px;
    padding:14px;
    font-size:16px;
    justify-content: center;
  }
  
  footer{
    margin-top:24px;
    color:var(--muted);
    font-size:14px;
    text-align:center;
    padding-top:16px;
    border-top:1px solid var(--border);
  }
  
  /* popup */
  .overlay{
    position:fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display:none;
    align-items:center;
    justify-content:center;
    backdrop-filter: blur(8px);
    z-index:150;
    background:rgba(0, 0, 0, 0.5);
    padding: 16px;
  }
  
  .overlay.show{
    display: flex;
  }
  
  .progress-modal{
    width:100%;
    max-width:500px;
    background:var(--card);
    padding:20px;
    border-radius:24px;
    border:1px solid var(--border);
    box-shadow:0 25px 60px rgba(0,0,0,0.15);
    position:relative;
    animation: modalAppear 0.3s ease-out;
  }
  
  @keyframes modalAppear {
    from {
      opacity: 0;
      transform: translateY(-20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  @media (min-width: 576px) {
    .progress-modal {
      padding: 24px;
    }
  }
  
  .progress-modal::before{
    content:'';
    position:absolute;
    top:0;
    right:0;
    width:100%;
    height:4px;
    background:linear-gradient(90deg, var(--accent), var(--accent-2));
    border-radius:24px 24px 0 0;
  }
  
  .prog-row{
    display:flex;
    align-items:center;
    gap:16px;
    margin-bottom:16px;
    padding:16px;
    border-radius:16px;
    background:var(--bg);
    border:1px solid var(--border);
    transition: all 0.3s ease;
  }
  
  .prog-row:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
  }
  
  .prog-info{
    flex:1;
  }
  
  .bar{
    width:100%;
    height:12px;
    background:var(--border);
    border-radius:10px;
    overflow:hidden;
    margin-top:8px;
    position: relative;
  }
  
  .bar > i{
    display:block;
    height:100%;
    width:0%;
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    border-radius:10px;
    transition:width .3s ease;
  }
  
  .bar-percent {
    position: absolute;
    top: -20px;
    left: 0;
    font-size: 12px;
    font-weight: 600;
    color: var(--accent);
  }
  
  .small-muted{
    font-size:13px;
    color:var(--muted);
  }
  
  .ok{
    background:var(--success);
    color:#fff;
    padding:10px 20px;
    border-radius:12px;
    border:none;
    cursor:pointer;
    font-weight:600;
    transition:all 0.3s ease;
    display:inline-flex;
    align-items:center;
    gap:8px;
    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
  }
  
  .ok:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(16, 185, 129, 0.4);
  }
  
  .danger{
    background:#ef4444;
    color:#fff;
    padding:10px 20px;
    border-radius:12px;
    border:none;
    cursor:pointer;
    font-weight:600;
    transition:all 0.3s ease;
    display:inline-flex;
    align-items:center;
    gap:8px;
    box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
  }
  
  .danger:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(239, 68, 68, 0.4);
  }
  
  .upload-icon{
    font-size: 40px;
    color:var(--accent);
    margin-bottom:16px;
  }
  
  @media (min-width: 768px) {
    .upload-icon {
      font-size: 48px;
    }
  }
  
  .tip-box{
    background:linear-gradient(135deg, rgba(236, 72, 153, 0.05), rgba(244, 114, 182, 0.05));
    padding:16px;
    border-radius:16px;
    border:1px solid rgba(236, 72, 153, 0.2);
    margin-top:16px;
  }
  
  .tip-box ul{
    margin:0;
    padding-right:20px;
    color:var(--muted);
    font-size:14px;
    line-height:1.7;
  }
  
  .tip-box li{
    margin-bottom:8px;
  }
  
  .stats{
    display:flex;
    gap:16px;
    margin-top:16px;
  }
  
  .stat-item{
    flex:1;
    text-align:center;
    padding:16px;
    background:var(--bg);
    border-radius:16px;
    border:1px solid var(--border);
    transition: all 0.3s ease;
  }
  
  .stat-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
  }
  
  .stat-value{
    font-size:24px;
    font-weight:700;
    color:var(--accent);
    margin-bottom:4px;
  }
  
  .stat-label{
    font-size:13px;
    color:var(--muted);
  }
  
  .empty-state{
    text-align:center;
    padding:40px 20px;
    color:var(--muted);
  }
  
  .empty-state i{
    font-size:64px;
    margin-bottom:16px;
    color:var(--accent);
    opacity:0.3;
  }
  
  .warning-note {
    background: rgba(245, 158, 11, 0.1);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: 12px;
    padding: 12px 16px;
    margin-top: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .warning-note i {
    color: #f59e0b;
    font-size: 18px;
  }
  
  .warning-note div {
    color: #92400e;
    font-size: 13px;
    flex: 1;
    font-weight: 500;
  }
  
  .progress-percent {
    font-size: 12px;
    font-weight: 700;
    color: var(--accent);
    margin-top: 4px;
  }
  
  .file-progress {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 8px;
  }
  
  .upload-status {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 4px;
  }
  
  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--muted);
  }
  
  .status-dot.pending {
    background: #f59e0b;
  }
  
  .status-dot.uploading {
    background: var(--accent);
    animation: pulse 1.5s infinite;
  }
  
  .status-dot.success {
    background: var(--success);
  }
  
  .status-dot.error {
    background: #ef4444;
  }
  
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }
  
  /* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª */
  .recorder-container {
    text-align: center;
    padding: 20px;
  }
  
  .recorder-display {
    margin: 20px 0;
    padding: 20px;
    background: var(--bg);
    border-radius: 16px;
    border: 1px solid var(--border);
  }
  
  .recorder-visualizer {
    height: 60px;
    margin: 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3px;
  }
  
  .visualizer-bar {
    width: 4px;
    background: var(--accent);
    border-radius: 2px;
    transition: height 0.1s ease;
  }
  
  .recorder-time {
    font-size: 24px;
    font-weight: 700;
    color: var(--accent);
    margin: 10px 0;
  }
  
  .recorder-controls {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 20px;
  }
  
  .record-btn {
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
    transition: all 0.3s ease;
  }
  
  .record-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 16px rgba(236, 72, 153, 0.4);
  }
  
  .record-btn.recording {
    background: #ef4444;
    animation: pulse 1.5s infinite;
  }
  
  .audio-clips {
    margin-top: 20px;
    max-height: 300px;
    overflow-y: auto;
  }
  
  .audio-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--bg);
    border-radius: 12px;
    border: 1px solid var(--border);
    margin-bottom: 8px;
  }
  
  .audio-info {
    flex: 1;
  }
  
  .audio-name {
    font-weight: 600;
    color: var(--text);
  }
  
  .audio-meta {
    font-size: 12px;
    color: var(--muted);
  }
  
  /* ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ø±Ø¶ */
  .recording-timer {
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 600;
    margin: 10px 0;
    display: inline-block;
    box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
  }
  
  .clip-actions {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  
  .action-btn {
    padding: 6px 12px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--bg);
    color: var(--text);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  
  .action-btn:hover {
    background: var(--accent);
    color: white;
    transform: translateY(-1px);
  }
  
  .recording-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 10px 0;
  }
  
  .pulse-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #ef4444;
    animation: pulse 1.5s infinite;
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo"><i class="fas fa-cloud-upload-alt"></i></div>
    <div>
      <h1>Media - Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª</h1>
      <p class="lead">Ø±ÙØ¹ ØµÙˆØ± ÙˆÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ Ø¨Ø£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø©ØŒ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ù†Øµ ÙˆØµÙÙŠØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù… Ø§Ù„Ø±ÙØ¹ ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©.</p>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" data-tab="files">ğŸ“ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</button>
    <button class="tab" data-tab="record">ğŸ¤ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ</button>
  </div>

  <main style="margin-top:24px">
    <!-- ØªØ¨ÙˆÙŠØ¨ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª -->
    <div id="files" class="tab-content active">
      <form id="mainForm" class="grid" onsubmit="return false;">
        <div class="card">
          <label><i class="fas fa-folder-open"></i> Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª (ØµÙˆØ±/ÙÙŠØ¯ÙŠÙˆ) - ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</label>
          <div class="uploader" id="uploader">
            <div class="upload-icon">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div style="max-width:100%">
              <strong style="font-size:18px">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ£Ø³Ù‚Ø·Ù‡Ø§ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª</strong>
              <div class="meta" style="margin-top:10px">
                <span><i class="fas fa-check-circle"></i> ÙŠØ¯Ø¹Ù… JPG, PNG, HEIC, MP4, MOV</span>
                <span>â€¢</span>
                <span><i class="fas fa-download"></i> Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ…Ù„Ù Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</span>
              </div>
            </div>
            <div style="margin-top:16px" class="controls">
              <label class="btn" for="filesInput"><i class="fas fa-plus"></i> Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª</label>
              <input id="filesInput" type="file" multiple accept="image/*,video/*" />
              <button id="sendAllBtn" class="btn send-btn"><i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</button>
            </div>
          </div>

          <div class="warning-note">
            <i class="fas fa-exclamation-triangle"></i>
            <div>Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ù‡Ùˆ 50MB (Ù‚ÙŠØ¯ ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù„Ù„Ø¨ÙˆØªØ§Øª). Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£ÙƒØ¨Ø± Ù‚Ø¯ ÙŠØªÙ… Ø±ÙØ¶Ù‡Ø§.</div>
          </div>

          <div style="margin-top:20px">
            <label><i class="fas fa-pen"></i> Ø§Ù„Ù†Øµ Ø§Ù„ÙˆØµÙÙŠ (Ø³ÙŠØ¸Ù‡Ø± Ù…Ø¹ ÙƒÙ„ Ù…Ù„Ù)</label>
            <textarea id="caption" class="caption" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ø§Ù„ÙˆØµÙÙŠ Ù‡Ù†Ø§..."></textarea>
          </div>

          <div style="margin-top:20px">
            <label><i class="fas fa-list"></i> Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</label>
            <div id="fileList" class="file-list">
              <div class="empty-state" id="emptyState">
                <i class="fas fa-folder-open"></i>
                <div>Ù„Ù… ØªÙ‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯</div>
                <div style="font-size:13px; margin-top:8px">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£Ø¹Ù„Ø§Ù‡ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª"</div>
              </div>
            </div>
          </div>
        </div>

        <aside>
          <div class="card" style="display:flex;flex-direction:column;gap:16px;height:100%">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-size:14px;color:var(--muted)"><i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                <div style="font-weight:600; margin-top:4px">Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© â€¢ ÙˆØ§Ø¬Ù‡Ø© Ù…ØªØ¬Ø§ÙˆØ¨Ø© â€¢ ØªØªØ¨Ø¹ Ø§Ù„ØªÙ‚Ø¯Ù…</div>
              </div>
              <div style="text-align:left">
                <div style="font-size:13px;color:var(--muted)">Ø§Ù„Ù†Ù…Ø·</div>
                <div style="font-weight:700;color:var(--accent)">ÙØ§ØªØ­</div>
              </div>
            </div>

            <div class="stats">
              <div class="stat-item">
                <div class="stat-value" id="fileCount">0</div>
                <div class="stat-label">Ø§Ù„Ù…Ù„ÙØ§Øª</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="totalSize">0</div>
                <div class="stat-label">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
              </div>
            </div>

            <div style="margin-top:auto; display:flex; gap:12px">
              <button id="clearBtn" class="btn" style="background:var(--bg);color:var(--text);flex:1"><i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
            </div>
          </div>
        </aside>
      </form>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª -->
    <div id="record" class="tab-content">
      <div class="card">
        <div class="recorder-container">
          <h2><i class="fas fa-microphone"></i> Ù…Ø³Ø¬Ù„ Ø§Ù„ØµÙˆØª</h2>
          <p class="lead">Ø³Ø¬Ù„ ØµÙˆØªÙƒ ÙˆØ§Ø­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø«Ù… Ø£Ø±Ø³Ù„Ù‡ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø¹Ù†Ø¯Ù…Ø§ ØªØ±ÙŠØ¯</p>
          
          <div class="recorder-display">
            <div class="recording-indicator" id="recordingIndicator" style="display:none">
              <div class="pulse-dot"></div>
              <div style="color:#ef4444;font-weight:600">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</div>
            </div>
            <div class="recorder-time" id="recorderTime">00:00</div>
            <div class="recording-timer" id="recordingTimer" style="display:none">0 Ø«Ø§Ù†ÙŠØ©</div>
            <div class="recorder-visualizer" id="visualizer"></div>
            <div class="recorder-controls">
              <button class="record-btn" id="recordBtn">
                <i class="fas fa-microphone"></i>
              </button>
              <button class="btn" id="stopRecordBtn" style="display:none;background:#ef4444">
                <i class="fas fa-stop"></i> Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
              </button>
              <button class="btn" id="clearRecordingsBtn" style="background:var(--bg);color:var(--text)">
                <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª
              </button>
            </div>
          </div>

          <div class="warning-note">
            <i class="fas fa-info-circle"></i>
            <div>Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª ØªØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹Ù‡Ø§ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø¹Ù†Ø¯Ù…Ø§ ØªØ±ÙŠØ¯</div>
          </div>

          <div style="margin-top:20px">
            <label><i class="fas fa-headphones"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</label>
            <div id="audioClips" class="audio-clips">
              <div class="empty-state">
                <i class="fas fa-microphone-slash"></i>
                <div>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div><i class="fas fa-heart" style="color:var(--accent)"></i> ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ Ø£Ù†ÙŠÙ‚ - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ¹Ù„ÙŠ</div>
  </footer>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø¯Ù… -->
<div id="overlay" class="overlay">
  <div class="progress-modal">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <div>
        <div style="font-weight:700;font-size:18px"><i class="fas fa-cloud-upload-alt"></i> Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</div>
        <div class="small-muted" id="overallInfo">0 / 0 Ù…Ù„ÙØ§Øª</div>
      </div>
      <div>
        <button id="closeOverlay" class="danger"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
    <div id="progressList" style="max-height:400px;overflow:auto;padding:4px"></div>
    <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:20px">
      <button id="doneBtn" class="ok" style="display:none"><i class="fas fa-check"></i> ØªÙ…</button>
    </div>
  </div>
</div>

<script>
// Media - Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª
class MediaApp {
  constructor() {
    this.initTabs();
    this.initFileUploader();
    this.initAudioRecorder();
  }
  
  initTabs() {
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        const tabId = tab.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
  }
  
  initFileUploader() {
    this.filesInput = document.getElementById('filesInput');
    this.uploader = document.getElementById('uploader');
    this.fileListEl = document.getElementById('fileList');
    this.captionEl = document.getElementById('caption');
    this.sendAllBtn = document.getElementById('sendAllBtn');
    this.clearBtn = document.getElementById('clearBtn');
    this.overlay = document.getElementById('overlay');
    this.progressList = document.getElementById('progressList');
    this.overallInfo = document.getElementById('overallInfo');
    this.doneBtn = document.getElementById('doneBtn');
    this.closeOverlay = document.getElementById('closeOverlay');
    this.emptyState = document.getElementById('emptyState');
    this.fileCountEl = document.getElementById('fileCount');
    this.totalSizeEl = document.getElementById('totalSize');
    
    this.DATA = null;
    this.files = [];
    this.uploadInProgress = false;
    
    this.initFileEventListeners();
  }
  
  initFileEventListeners() {
    this.uploader.addEventListener('dragover', (e) => { 
      e.preventDefault(); 
      this.uploader.classList.add('dragover');
    });
    
    this.uploader.addEventListener('dragleave', (e) => { 
      this.uploader.classList.remove('dragover');
    });
    
    this.uploader.addEventListener('drop', (e) => {
      e.preventDefault(); 
      this.uploader.classList.remove('dragover');
      if(e.dataTransfer.files) this.addFiles(e.dataTransfer.files);
    });
    
    this.filesInput.addEventListener('change', (e) => this.addFiles(e.target.files));
    this.sendAllBtn.addEventListener('click', (e) => this.handleUpload(e));
    this.clearBtn.addEventListener('click', () => this.clearFiles());
    this.closeOverlay.addEventListener('click', () => this.cancelUpload());
    this.doneBtn.addEventListener('click', () => this.closeOverlayFunc());
  }
  
  initAudioRecorder() {
    this.recordBtn = document.getElementById('recordBtn');
    this.stopRecordBtn = document.getElementById('stopRecordBtn');
    this.clearRecordingsBtn = document.getElementById('clearRecordingsBtn');
    this.recorderTime = document.getElementById('recorderTime');
    this.recordingTimer = document.getElementById('recordingTimer');
    this.recordingIndicator = document.getElementById('recordingIndicator');
    this.visualizer = document.getElementById('visualizer');
    this.audioClips = document.getElementById('audioClips');
    
    this.mediaRecorder = null;
    this.audioChunks = [];
    this.recording = false;
    this.recordingTime = 0;
    this.recordingInterval = null;
    this.audioContext = null;
    this.analyser = null;
    this.audioClipsList = [];
    
    this.initAudioEventListeners();
    this.loadAudioClips();
    this.initVisualizer();
  }
  
  initAudioEventListeners() {
    this.recordBtn.addEventListener('click', () => this.startRecording());
    this.stopRecordBtn.addEventListener('click', () => this.stopRecording());
    this.clearRecordingsBtn.addEventListener('click', () => this.clearRecordings());
  }
  
  // ========== Ù…Ù„ÙØ§Øª Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ==========
  
  uid() { 
    return Math.random().toString(36).slice(2,9); 
  }
  
  async loadConfig() {
    if (this.DATA) return this.DATA;
    
    try {
      const res = await fetch('./data.json', {cache: 'no-store'});
      if(!res.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ data.json â€” ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯');
      this.DATA = await res.json();
      if(!this.DATA.bot_token || !this.DATA.chat_id) {
        throw new Error('data.json Ù†Ø§Ù‚Øµ bot_token Ø£Ùˆ chat_id');
      }
      return this.DATA;
    } catch(err) {
      alert('Ø®Ø·Ø£: ' + err.message + '\nØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ data.json ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙˆÙƒØªØ§Ø¨ØªÙ‡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.');
      throw err;
    }
  }
  
  addFiles(fileList) {
    if(fileList.length > 0) {
      this.emptyState.style.display = 'none';
    }
    
    for(const f of Array.from(fileList)) {
      const id = this.uid();
      this.files.push({file: f, id});
      this.renderFileItem(f, id);
    }
    
    this.updateStats();
  }
  
  updateStats() {
    this.fileCountEl.textContent = this.files.length;
    
    const totalSize = this.files.reduce((sum, item) => sum + item.file.size, 0);
    this.totalSizeEl.textContent = this.formatBytes(totalSize);
  }
  
  renderFileItem(file, id) {
    const div = document.createElement('div');
    div.className = 'file-item';
    div.dataset.id = id;
    
    const thumb = document.createElement('div');
    thumb.className = 'thumb';
    if(file.type.startsWith('image/')) {
      const img = document.createElement('img');
      img.style.width = '100%';
      img.style.height = '100%';
      img.style.objectFit = 'cover';
      const url = URL.createObjectURL(file);
      img.src = url;
      img.onload = () => URL.revokeObjectURL(url);
      thumb.appendChild(img);
    } else if(file.type.startsWith('video/')) {
      thumb.innerHTML = '<i class="fas fa-video" style="font-size:24px"></i>';
    } else {
      thumb.innerHTML = '<i class="fas fa-file" style="font-size:24px"></i>';
    }
    
    const meta = document.createElement('div');
    meta.style.flex = '1';
    meta.innerHTML = `
      <div class="fi-name">${this.escapeHtml(file.name)}</div>
      <div class="fi-size">${this.formatBytes(file.size)} â€¢ ${file.type || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
    `;
    
    const del = document.createElement('button');
    del.className = 'btn';
    del.style.background = 'var(--bg)';
    del.style.border = '1px solid var(--border)';
    del.style.color = 'var(--text)';
    del.innerHTML = '<i class="fas fa-trash"></i>';
    del.onclick = () => {
      if (this.uploadInProgress) {
        alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø£Ø«Ù†Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹');
        return;
      }
      this.files = this.files.filter(x => x.id !== id);
      div.remove();
      this.updateStats();
      
      if(this.files.length === 0) {
        this.emptyState.style.display = 'block';
      }
    };
    
    div.appendChild(thumb);
    div.appendChild(meta);
    div.appendChild(del);
    this.fileListEl.appendChild(div);
  }
  
  formatBytes(bytes) {
    if(bytes === 0) return '0 B';
    const k = 1024;
    const dm = 2;
    const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
  }
  
  escapeHtml(s) { 
    return s.replace(/[&<>"']/g, c => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": "&#39;"
    }[c])); 
  }
  
  async handleUpload(e) {
    e.preventDefault();
    if(this.files.length === 0) { 
      alert('Ù„Ù… ØªÙ‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª'); 
      return; 
    }
    
    if (this.uploadInProgress) {
      alert('Ù‡Ù†Ø§Ùƒ Ø¹Ù…Ù„ÙŠØ© Ø±ÙØ¹ Ø¬Ø§Ø±ÙŠØ© Ø¨Ø§Ù„ÙØ¹Ù„');
      return;
    }
    
    try {
      await this.loadConfig();
    } catch { 
      return; 
    }
    
    this.openOverlay();
    this.uploadInProgress = true;
    await this.sendFilesSequential();
    this.uploadInProgress = false;
  }
  
  clearFiles() {
    if(this.files.length === 0) return;
    
    if (this.uploadInProgress) {
      alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ø³Ø­ Ø§Ù„Ù…Ù„ÙØ§Øª Ø£Ø«Ù†Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹');
      return;
    }
    
    if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§ØªØŸ')) {
      this.files = [];
      this.fileListEl.innerHTML = '';
      this.emptyState.style.display = 'block';
      this.updateStats();
    }
  }
  
  openOverlay() {
    this.overlay.classList.add('show');
    this.progressList.innerHTML = '';
    this.doneBtn.style.display = 'none';
    this.closeOverlay.style.display = 'inline-block';
  }
  
  closeOverlayFunc() {
    this.overlay.classList.remove('show');
    this.uploadInProgress = false;
  }
  
  cancelUpload() {
    if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹ØŸ')) this.closeOverlayFunc();
  }
  
  async sendFilesSequential() {
    const total = this.files.length;
    let done = 0;
    let successfulUploads = 0;
    this.overallInfo.textContent = `${done} / ${total} Ù…Ù„ÙØ§Øª`;
    
    for(const item of [...this.files]) {
      const f = item.file;
      const row = document.createElement('div');
      row.className = 'prog-row';
      row.id = 'row-' + item.id;
      row.innerHTML = `
        <div style="font-size:20px;color:var(--accent)">
          ${f.type.startsWith('image/') ? '<i class="fas fa-image"></i>' : 
            f.type.startsWith('video/') ? '<i class="fas fa-video"></i>' : 
            '<i class="fas fa-file"></i>'}
        </div>
        <div class="prog-info">
          <div style="font-weight:600">${this.escapeHtml(f.name)}</div>
          <div class="upload-status">
            <div class="status-dot pending"></div>
            <div class="small-muted" id="status-${item.id}">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±ÙØ¹...</div>
          </div>
          <div class="file-progress">
            <div class="bar">
              <i id="bar-${item.id}"></i>
              <div class="bar-percent" id="percent-${item.id}">0%</div>
            </div>
          </div>
        </div>
      `;
      this.progressList.appendChild(row);
      
      const MAX = 50 * 1024 * 1024;
      if(f.size > MAX) {
        const warn = document.createElement('div');
        warn.style.color = '#f59e0b';
        warn.style.fontSize = '12px';
        warn.style.marginTop = '6px';
        warn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…Ù„Ù Ø£ÙƒØ¨Ø± Ù…Ù† 50MB â€” Ù‚Ø¯ ÙŠØªÙ… Ø±ÙØ¶Ù‡ Ù…Ù† Ù‚Ø¨Ù„ ØªÙ„ÙŠØ¬Ø±Ø§Ù….';
        row.appendChild(warn);
      }
      
      try {
        const statusDot = row.querySelector('.status-dot');
        statusDot.classList.remove('pending');
        statusDot.classList.add('uploading');
        
        await this.sendSingleFile(f, item.id, (percent) => {
          const el = document.getElementById('bar-' + item.id);
          const st = document.getElementById('status-' + item.id);
          const percentEl = document.getElementById('percent-' + item.id);
          if(el) el.style.width = percent + '%';
          if(st) st.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹... ' + percent.toFixed(0) + '%';
          if(percentEl) percentEl.textContent = percent.toFixed(0) + '%';
        });
        
        const st = document.getElementById('status-' + item.id);
        const statusDotSuccess = row.querySelector('.status-dot');
        if(st) {
          st.textContent = 'ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­ âœ“';
          st.style.color = 'var(--success)';
          st.style.fontWeight = '600';
        }
        if(statusDotSuccess) {
          statusDotSuccess.classList.remove('uploading');
          statusDotSuccess.classList.add('success');
        }
        done++;
        successfulUploads++;
        this.overallInfo.textContent = `${done} / ${total} Ù…Ù„ÙØ§Øª (${successfulUploads} Ù†Ø§Ø¬Ø­)`;
      } catch(err) {
        const st = document.getElementById('status-' + item.id);
        const statusDotError = row.querySelector('.status-dot');
        if(st) {
          st.textContent = 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø±ÙØ¹: ' + (err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ');
          st.style.color = '#ef4444';
          st.style.fontWeight = '600';
        }
        if(statusDotError) {
          statusDotError.classList.remove('uploading');
          statusDotError.classList.add('error');
        }
        done++;
        this.overallInfo.textContent = `${done} / ${total} Ù…Ù„ÙØ§Øª (${successfulUploads} Ù†Ø§Ø¬Ø­)`;
      }
    }
    
    this.doneBtn.style.display = 'inline-block';
    this.closeOverlay.style.display = 'none';
    
    if (successfulUploads === total) {
      this.overallInfo.innerHTML = `<span style="color:var(--success)">ØªÙ… Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­! (${successfulUploads}/${total})</span>`;
    } else {
      this.overallInfo.innerHTML = `<span style="color:#ef4444">ØªÙ… Ø±ÙØ¹ ${successfulUploads} Ù…Ù† ${total} Ù…Ù„Ù</span>`;
    }
  }
  
  sendSingleFile(file, id, onProgress) {
    return new Promise((resolve, reject) => {
      const token = this.DATA.bot_token.trim();
      const chat_id = this.DATA.chat_id;
      
      const url = `https://api.telegram.org/bot${encodeURIComponent(token)}/sendDocument`;
      
      const form = new FormData();
      form.append('chat_id', chat_id);
      form.append('caption', this.captionEl.value || '');
      form.append('document', file, file.name);
      
      const xhr = new XMLHttpRequest();
      xhr.open('POST', url, true);
      
      xhr.upload.onprogress = (e) => {
        if(e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          onProgress(percent);
        }
      };
      
      xhr.onload = function() {
        if(xhr.status >= 200 && xhr.status < 300) {
          try {
            const resp = JSON.parse(xhr.responseText);
            if(resp.ok) {
              resolve(resp);
            } else {
              reject(new Error('Telegram API: ' + (resp.description || 'unknown error')));
            }
          } catch(err) {
            reject(new Error('Failed to parse response'));
          }
        } else {
          reject(new Error('HTTP ' + xhr.status + ': ' + xhr.statusText));
        }
      };
      
      xhr.onerror = function() { 
        reject(new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©')); 
      };
      
      xhr.ontimeout = function() {
        reject(new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„'));
      };
      
      xhr.timeout = 300000;
      xhr.send(form);
    });
  }
  
  // ========== Ù…Ù„ÙØ§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª ==========
  
  async startRecording() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      this.mediaRecorder = new MediaRecorder(stream);
      this.audioChunks = [];
      
      this.mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          this.audioChunks.push(event.data);
        }
      };
      
      this.mediaRecorder.onstop = () => {
        const audioBlob = new Blob(this.audioChunks, { type: 'audio/mpeg' });
        this.saveAudioRecording(audioBlob);
        stream.getTracks().forEach(track => track.stop());
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª ÙˆØ¥Ø²Ø§Ù„ØªÙ‡
        clearInterval(this.recordingInterval);
        this.recordingTimer.style.display = 'none';
        this.recordingIndicator.style.display = 'none';
      };
      
      // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
      let seconds = 0;
      this.recordingTimer.style.display = 'inline-block';
      this.recordingIndicator.style.display = 'flex';
      this.recordingInterval = setInterval(() => {
        seconds++;
        this.recordingTimer.textContent = `${seconds} Ø«Ø§Ù†ÙŠØ©`;
      }, 1000);
      
      this.mediaRecorder.start();
      this.recording = true;
      this.recordBtn.classList.add('recording');
      this.stopRecordBtn.style.display = 'inline-block';
      
      this.startVisualizer(stream);
      
    } catch (error) {
      alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†: ' + error.message);
    }
  }
  
  stopRecording() {
    if (this.mediaRecorder && this.recording) {
      this.mediaRecorder.stop();
      this.recording = false;
      this.recordBtn.classList.remove('recording');
      this.stopRecordBtn.style.display = 'none';
    }
  }
  
  initVisualizer() {
    for (let i = 0; i < 30; i++) {
      const bar = document.createElement('div');
      bar.className = 'visualizer-bar';
      bar.style.height = '5px';
      this.visualizer.appendChild(bar);
    }
  }
  
  startVisualizer(stream) {
    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    this.analyser = this.audioContext.createAnalyser();
    const source = this.audioContext.createMediaStreamSource(stream);
    source.connect(this.analyser);
    this.analyser.fftSize = 64;
    
    const bufferLength = this.analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);
    
    const updateVisualizer = () => {
      if (!this.recording) return;
      
      this.analyser.getByteFrequencyData(dataArray);
      const bars = this.visualizer.querySelectorAll('.visualizer-bar');
      
      bars.forEach((bar, i) => {
        const value = dataArray[i] || 0;
        const height = Math.max(5, value / 2);
        bar.style.height = `${height}px`;
        bar.style.background = `linear-gradient(to top, var(--accent), var(--accent-2))`;
      });
      
      requestAnimationFrame(updateVisualizer);
    };
    
    updateVisualizer();
  }
  
  stopVisualizer() {
    const bars = this.visualizer.querySelectorAll('.visualizer-bar');
    bars.forEach(bar => {
      bar.style.height = '5px';
      bar.style.background = 'var(--muted)';
    });
    
    if (this.audioContext) {
      this.audioContext.close();
      this.audioContext = null;
    }
  }
  
  saveAudioRecording(audioBlob) {
    const audioId = this.uid();
    const name = `rec_${Date.now()}.mp3`;
    
    const audioItem = {
      id: audioId,
      name: name,
      blob: audioBlob,
      size: audioBlob.size,
      duration: this.recordingTime,
      createdAt: new Date().toISOString(),
      status: 'pending'
    };
    
    this.audioClipsList.push(audioItem);
    localStorage.setItem('audioRecordings', JSON.stringify(this.audioClipsList));
    
    this.renderAudioItem(audioItem);
  }
  
  loadAudioClips() {
    const saved = localStorage.getItem('audioRecordings');
    if (saved) {
      this.audioClipsList = JSON.parse(saved);
      this.audioClipsList.forEach(audio => this.renderAudioItem(audio));
    }
  }
  
  renderAudioItem(audio) {
    const emptyState = this.audioClips.querySelector('.empty-state');
    if (emptyState) emptyState.style.display = 'none';
    
    const audioItem = document.createElement('div');
    audioItem.className = 'audio-item';
    audioItem.dataset.id = audio.id;
    
    audioItem.innerHTML = `
      <div style="font-size:24px;color:var(--accent)">
        <i class="fas fa-microphone"></i>
      </div>
      <div class="audio-info">
        <div class="audio-name">${audio.name}</div>
        <div class="audio-meta">
          ${this.formatBytes(audio.size)} â€¢ ${new Date(audio.createdAt).toLocaleString('ar-EG')}
        </div>
      </div>
      <div class="clip-actions">
        <button class="action-btn play-audio">
          <i class="fas fa-play"></i> ØªØ´ØºÙŠÙ„
        </button>
        <button class="action-btn send-audio">
          <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
        </button>
        <button class="action-btn delete-audio">
          <i class="fas fa-trash"></i> Ø­Ø°Ù
        </button>
      </div>
    `;
    
    audioItem.querySelector('.play-audio').addEventListener('click', () => {
      this.playAudio(audio.blob);
    });
    
    audioItem.querySelector('.send-audio').addEventListener('click', async () => {
      if(!confirm('ØªØ±ÙØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø¨ÙˆØªØŸ')) return;
      await this.uploadAudioRecording(audio);
    });
    
    audioItem.querySelector('.delete-audio').addEventListener('click', () => {
      this.deleteAudio(audio.id, audioItem);
    });
    
    this.audioClips.appendChild(audioItem);
  }
  
  playAudio(blob) {
    const audioURL = URL.createObjectURL(blob);
    const audio = new Audio(audioURL);
    audio.play();
  }
  
  deleteAudio(audioId, audioElement) {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŸ')) {
      this.audioClipsList = this.audioClipsList.filter(audio => audio.id !== audioId);
      localStorage.setItem('audioRecordings', JSON.stringify(this.audioClipsList));
      audioElement.remove();
      
      if (this.audioClipsList.length === 0) {
        this.audioClips.innerHTML = '<div class="empty-state"><i class="fas fa-microphone-slash"></i><div>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</div></div>';
      }
    }
  }
  
  clearRecordings() {
    if (this.audioClipsList.length === 0) return;
    
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§ØªØŸ')) {
      this.audioClipsList = [];
      localStorage.removeItem('audioRecordings');
      this.audioClips.innerHTML = '<div class="empty-state"><i class="fas fa-microphone-slash"></i><div>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</div></div>';
    }
  }
  
  async uploadAudioRecording(audioItem) {
    try {
      await this.loadConfig();
      
      const token = this.DATA.bot_token.trim();
      const chat_id = this.DATA.chat_id;
      const url = `https://api.telegram.org/bot${encodeURIComponent(token)}/sendDocument`;
      
      const form = new FormData();
      form.append('chat_id', chat_id);
      form.append('caption', `ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ - ${new Date(audioItem.createdAt).toLocaleString('ar-EG')}`);
      form.append('document', audioItem.blob, audioItem.name);
      
      const response = await fetch(url, {
        method: 'POST',
        body: form
      });
      
      const result = await response.json();
      
      if (result.ok) {
        alert('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
        console.log('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­:', audioItem.name);
      } else {
        alert('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + (result.description || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
        console.error('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', result.description);
      }
    } catch (error) {
      alert('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + error.message);
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
    }
  }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', () => {
  new MediaApp();
});
</script>
</body>
</html>